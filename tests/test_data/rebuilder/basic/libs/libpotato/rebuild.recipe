!rebuild.recipe!

package libpotato 1.0.0
  export_compilation_flags_requirements
    all: libstarch

  requirements
    all: RUN libstarch >= 1.0.0
    all: TOOL tbar >= 1.0.0

  steps  
    step_setup
      copy_source_to_build_dir: True
      tarball_source_dir_override
        all: src

    step_make
      make_flags
        all: LDFLAGS="${REBUILD_REQUIREMENTS_LDFLAGS}"
        all: CFLAGS="-std=c99 ${REBUILD_COMPILE_ARCH_FLAGS} ${REBUILD_REQUIREMENTS_CFLAGS}"
        linux: CC=gcc
        macos: CC=clang
        #macos: AR=${AR_REPLACEMENT}

    step_make_install

    step_post_install
      pc_files
        all: libpotato.pc
      skip_binary_third_party_prefix: True
      tests
        all: test-libpotato.c test-libpotato-env-var-from-tool.c
